<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Position caret</title>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript">
        /*
        We need to be able to find the current caret (cursor) position in the page.
        We also need to be able to move this caret using both the mouse and the arrow keys.

         */
        var caret = window.getSelection();


        $(document).ready(function() {
            documentSizeInCharacters();
            // initialize selection
            var range = document.createRange();

            console.log(caret);
            var leaf = firstLeaf();
            range.setStart(leaf, 0);
            range.setEnd(leaf, 0);
            console.log(range);
            var selection = window.getSelection();
            //range.select();
            selection.addRange(range);
            caret = window.getSelection();
            console.log(caret);
            /*console.log(leaf);
            caret.setStart(leaf, 0);
            caret.setEnd(leaf, 0);
            console.log(caret);*/
        });

        function documentSizeInCharacters() {
            var leaf = firstLeaf();
            var text = [];
            var length = 0;
            while (leaf != null) {
                text.push(leaf.textContent);
                length = length + leaf.textContent.length;
                leaf = nextNode(leaf);
            }
            console.log(text);
            console.log(length);
        }

        function firstLeaf() {
            var htmlElement = document.getElementsByTagName("body")[0];
            var leaf = htmlElement;
            while (leaf.firstChild != null) {
                leaf = leaf.firstChild;
            }
            return leaf;
        }

        function nextNode(node) {
            // we always try to get the next leaf element, which is a text node
            while (node != null && node.nextSibling == null) {
                node = node.parentNode;
            }
            if (node == null) return null;
            var leaf = node.nextSibling;
            while (leaf.firstChild != null) {
                leaf = leaf.firstChild;
            }
            return leaf;
        }


    </script>
</head>
<body>

<p>Unu doi trei patru <b>cinci</b> sase sapte <span>opt noua</span></p>
<p>Zece unsprazece douasprazece:
<ul>
    <li>treisprazece</li>
    <li>paisprazece cincisprazece</li>
    <li><span>saisprazece</span> saptesprazece</li>
    <li><a href="google.com">optsprazece</a></li>
</ul>
</p>
</body>
</html>